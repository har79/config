#!/bin/bash

declare -r TARGET="$PWD"
declare -r SELF="$(realpath "$0")"
(
  cd "$(dirname "$SELF")"
  declare cmd=(
    find . \
        -maxdepth 1 \
        -not -type d \
        -not \( -name "$(basename "$SELF")" -or -name "package.json" -or -name "LICENSE" -or -name "README.md" \) \
  )
  if [ $# -ne 0 ]; then
    cmd+=( \( -false )
    for name in "$@"; do
      cmd+=(-or -name "*${name}*")
    done
    cmd+=( \) )
  fi
  ${cmd[@]} | while read file; do
    if [ "${file}" == "./.npmignore" ]; then
      cp "${file}" "${TARGET}/.gitignore"
      for link in .eslintignore .hgignore .prettierignore; do
        ln -s ".gitignore" "${TARGET}/${link}"
      done
    else
      cp "${file}" "${TARGET}"
    fi
  done
)
